<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>打卡系統</title>
</head>
<body>
    <div id="root"></div>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script type="text/babel">
        const { useState, useEffect } = React;
        const SUPABASE_URL = 'https://yjapigeaeygoxfcawxgf.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlqYXBpZ2VhZXlnb3hmY2F3eGdmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mjc3NTA2MjMsImV4cCI6MjA0MzMyNjYyM30.N_DoPPvtS5W4zXA3qQjQKEEw6fkH_sQ2qSWPv3kKKf4';
        const supabase={from:t=>({insert:async e=>{const a=await fetch(`${SUPABASE_URL}/rest/v1/${t}`,{method:"POST",headers:{apikey:SUPABASE_ANON_KEY,Authorization:`Bearer ${SUPABASE_ANON_KEY}`,"Content-Type":"application/json",Prefer:"return=representation"},body:JSON.stringify(e)});return{data:await a.json(),error:a.ok?null:new Error("Insert failed")}},update:async e=>({eq:async a=>{const r=await fetch(`${SUPABASE_URL}/rest/v1/${t}?${a}=eq.${arguments[1]}`,{method:"PATCH",headers:{apikey:SUPABASE_ANON_KEY,Authorization:`Bearer ${SUPABASE_ANON_KEY}`,"Content-Type":"application/json",Prefer:"return=representation"},body:JSON.stringify(e)});return{data:await r.json(),error:r.ok?null:new Error("Update failed")}}})})};function AttendanceSystem(){const[e,t]=useState(new Date),[a,r]=useState(!1),[n,s]=useState(!1),[o,i]=useState(null),[l,c]=useState(null),[d,u]=useState([{id:1,description:"",progress:0,notes:""},{id:2,description:"",progress:0,notes:""},{id:3,description:"",progress:0,notes:""}]),[p,m]=useState(!1),[h,f]=useState(null);useEffect(()=>{(async()=>{try{const e=(new Date).toISOString().split("T")[0],{data:t}=await supabase.from("work_logs").insert({date:e});t&&t[0]&&f(t[0].id)}catch(e){}})()},[]),useEffect(()=>{const a=setInterval(()=>{t(new Date)},1e3);return()=>clearInterval(a)},[]);const g=e=>e.toLocaleTimeString("zh-TW",{timeZone:"Asia/Taipei",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}),b=e=>e.toLocaleDateString("zh-TW",{timeZone:"Asia/Taipei",year:"numeric",month:"2-digit",day:"2-digit",weekday:"short"}),y=async()=>{const e=new Date;r(!0),i(e);try{const t=e.toISOString().split("T")[0];await supabase.from("attendance").insert({date:t,clock_in:e.toISOString()})}catch(e){}},v=async()=>{const e=new Date;s(!0),c(e);try{const t=e.toISOString().split("T")[0];await supabase.from("attendance").update({clock_out:e.toISOString()}).eq("date",t)}catch(e){}},w=(e,t,a)=>{u(d.map(r=>r.id===e?{...r,[t]:a}:r))},k=async()=>{if(!h)return void alert("工作日誌尚未初始化");try{let e=0;for(const t of d)if(t.description||t.progress>0){const a=await fetch(`${SUPABASE_URL}/rest/v1/daily_tasks`,{method:"POST",headers:{apikey:SUPABASE_ANON_KEY,Authorization:`Bearer ${SUPABASE_ANON_KEY}`,"Content-Type":"application/json",Prefer:"return=representation"},body:JSON.stringify({work_log_id:h,task_number:t.id,task_description:t.description,progress:t.progress,incomplete_notes:t.notes})});a.ok&&e++}e>0?alert(`成功儲存 ${e} 個任務`):alert("沒有任務需要儲存")}catch(e){alert("儲存失敗")}},x=async()=>{try{const e=await fetch("https://vita2025.zeabur.app/webhook/attendance-export");if(!e.ok)throw new Error("匯出失敗");const t=await e.blob(),a=window.URL.createObjectURL(t),r=document.createElement("a");r.href=a,r.download=`打卡系統備份_${(new Date).toISOString().split("T")[0]}.xlsx`,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(a),alert("備份下載成功")}catch(e){alert("下載失敗")}},S=async()=>{try{const e=await fetch("https://vita2025.zeabur.app/webhook/attendance-export");if(!e.ok)throw new Error("匯出失敗");const t=await e.blob(),a=window.URL.createObjectURL(t),r=document.createElement("a");r.href=a,r.download=`本週報表_${(new Date).toISOString().split("T")[0]}.xlsx`,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(a),alert("週報下載成功")}catch(e){alert("下載失敗")}};return React.createElement("div",{style:{minHeight:"100vh",background:"linear-gradient(135deg,#0a0a0a 0%,#1a1a2e 25%,#0a0a0a 50%,#16213e 75%,#0a0a0a 100%)",backgroundSize:"400% 400%",animation:"gradientShift 15s ease infinite",color:"#fff",padding:"2rem",fontFamily:'-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif',position:"relative",overflow:"hidden"}},React.createElement("style",null,"@keyframes gradientShift{0%,100%{background-position:0 50%}50%{background-position:100% 50%}}@keyframes pulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.95;transform:scale(1.02)}}@keyframes glow{0%,100%{box-shadow:0 0 20px rgba(0,255,136,.3)}50%{box-shadow:0 0 40px rgba(0,255,136,.6)}}"),React.createElement("div",{style:{maxWidth:"1000px",margin:"0 auto",position:"relative",zIndex:1}},React.createElement("div",{style:{position:"absolute",top:"0",right:"0",zIndex:10}},React.createElement("button",{onClick:()=>m(!p),style:{background:"rgba(26,26,26,.8)",border:"1px solid rgba(255,255,255,.1)",borderRadius:".75rem",padding:".75rem 1rem",color:"#00ff88",fontSize:"1.5rem",cursor:"pointer",transition:"all .3s ease",backdropFilter:"blur(10px)"}},"⚙️"),p&&React.createElement("div",{style:{position:"absolute",top:"4rem",right:"0",background:"rgba(26,26,26,.95)",border:"1px solid rgba(0,255,136,.3)",borderRadius:".75rem",padding:".5rem",minWidth:"200px",backdropFilter:"blur(20px)",boxShadow:"0 10px 40px rgba(0,0,0,.5)"}},React.createElement("button",{onClick:x,style:{width:"100%",textAlign:"left",padding:".75rem 1rem",background:"transparent",border:"none",color:"#fff",cursor:"pointer",borderRadius:".5rem",fontSize:".875rem"}},"📥 下載所有備份"),React.createElement("button",{onClick:S,style:{width:"100%",textAlign:"left",padding:".75rem 1rem",background:"transparent",border:"none",color:"#fff",cursor:"pointer",borderRadius:".5rem",fontSize:".875rem"}},"📊 匯出本週報表"),React.createElement("div",{style:{padding:".75rem 1rem",fontSize:".75rem",color:"#666",borderTop:"1px solid rgba(255,255,255,.05)",marginTop:".5rem"}},"☁️ 自動備份：每週五 18:00"))),React.createElement("div",{style:{textAlign:"center",marginBottom:"4rem",animation:"pulse 2s ease-in-out infinite"}},React.createElement("div",{style:{fontSize:".875rem",color:"#999",marginBottom:".5rem"}},b(e)),React.createElement("div",{style:{fontSize:"6rem",fontWeight:"700",letterSpacing:"-.02em",background:"linear-gradient(135deg,#fff 0%,#00ff88 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"}},g(e)),React.createElement("div",{style:{fontSize:".875rem",color:"#666",marginTop:".5rem"}},"臺灣時間")),React.createElement("div",{style:{display:"flex",gap:"1rem",justifyContent:"center",marginBottom:"4rem"}},React.createElement("button",{onClick:y,disabled:a,style:{padding:"1.25rem 2.5rem",fontSize:"1.125rem",fontWeight:"600",border:"none",borderRadius:".75rem",cursor:a?"not-allowed":"pointer",background:a?"rgba(26,26,26,.8)":"#00ff88",color:a?"#555":"#000",transition:"all .3s ease",animation:a?"none":"glow 2s ease-in-out infinite"}},a?`已上班 ${o?g(o):""}`:"上班打卡"),React.createElement("button",{onClick:v,disabled:!a||n,style:{padding:"1.25rem 2.5rem",fontSize:"1.125rem",fontWeight:"600",border:"none",borderRadius:".75rem",cursor:!a||n?"not-allowed":"pointer",background:!a||n?"rgba(26,26,26,.8)":"#00ff88",color:!a||n?"#555":"#000",transition:"all .3s ease",animation:a&&!n?"glow 2s ease-in-out infinite":"none"}},n?`已下班 ${l?g(l):""}`:"下班打卡")),React.createElement("div",{style:{height:"1px",background:"linear-gradient(90deg,transparent,rgba(0,255,136,.3),transparent)",margin:"3rem 0"}}),React.createElement("div",null,React.createElement("h2",{style:{fontSize:"2rem",fontWeight:"700",marginBottom:"2rem",background:"linear-gradient(135deg,#fff 0%,#00ff88 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"}},"📅 今日工作日誌"),d.map((e,t)=>React.createElement("div",{key:e.id,style:{background:"rgba(26,26,26,.6)",backdropFilter:"blur(10px)",border:"1px solid rgba(255,255,255,.05)",padding:"2rem",borderRadius:"1rem",marginBottom:"1.5rem",transition:"all .3s ease"}},React.createElement("div",{style:{display:"flex",gap:"1rem",marginBottom:"1.5rem"}},React.createElement("span",{style:{color:"#666",fontWeight:"700",fontSize:"1.25rem"}},t+1,"."),React.createElement("input",{type:"text",value:e.description,onChange:t=>w(e.id,"description",t.target.value),placeholder:"輸入重要事項...",style:{flex:"1",background:"transparent",border:"none",borderBottom:"2px solid rgba(255,255,255,.1)",padding:".5rem 0",fontSize:"1.125rem",color:"#fff",outline:"none"}})),React.createElement("div",{style:{marginLeft:"2.5rem"}},React.createElement("div",{style:{display:"flex",alignItems:"center",gap:"1rem",marginBottom:"1rem"}},React.createElement("span",{style:{color:"#888",fontSize:".875rem",width:"4rem"}},"進度:"),React.createElement("input",{type:"number",min:"0",max:"100",value:e.progress,onChange:t=>w(e.id,"progress",Math.min(100,Math.max(0,parseInt(t.target.value)||0))),style:{width:"5rem",background:"rgba(10,10,10,.8)",border:"1px solid rgba(255,255,255,.1)",borderRadius:".5rem",padding:".5rem",textAlign:"center",color:"#fff",outline:"none"}}),React.createElement("span",{style:{color:"#888"}},"%")),React.createElement("div",{style:{height:".75rem",background:"rgba(50,50,50,.5)",borderRadius:"1rem",overflow:"hidden",marginBottom:"1rem",border:"1px solid rgba(255,255,255,.05)"}},React.createElement("div",{style:{height:"100%",width:`${e.progress}%`,background:e.progress>=100?"linear-gradient(90deg,#00ff88,#00cc6a)":"linear-gradient(90deg,#ff6b35,#ff8c42)",borderRadius:"1rem",transition:"all .5s ease",boxShadow:e.progress>=100?"0 0 20px rgba(0,255,136,.6)":"0 0 15px rgba(255,107,53,.4)"}})),e.progress<100&&React.createElement("div",{style:{display:"flex",alignItems:"flex-start",gap:"1rem"}},React.createElement("span",{style:{color:"#888",fontSize:".875rem",width:"4rem"}},"未完成:"),React.createElement("input",{type:"text",value:e.notes,onChange:t=>w(e.id,"notes",t.target.value),placeholder:"還需要做什麼...",style:{flex:"1",background:"rgba(10,10,10,.8)",border:"1px solid rgba(255,255,255,.1)",borderRadius:".5rem",padding:".75rem",color:"#fff",fontSize:".875rem",outline:"none"}}))))),React.createElement("div",{style:{textAlign:"center",marginTop:"2rem"}},React.createElement("button",{onClick:k,style:{padding:"1rem 2.5rem",background:"linear-gradient(135deg,#00ff88,#00cc6a)",border:"none",color:"#000",fontSize:"1.125rem",fontWeight:"600",borderRadius:".75rem",cursor:"pointer",transition:"all .3s ease",boxShadow:"0 4px 15px rgba(0,255,136,.3)"}},"💾 儲存工作日誌")))))}ReactDOM.render(React.createElement(AttendanceSystem),document.getElementById("root"));
    </script>
</body>
</html>